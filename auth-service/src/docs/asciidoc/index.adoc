
= Auth-Service API Docs
:toc-title: Auth-Service API
:doctype: book
:icons: font
:source-highlighter: highlightjs
:toc: left
:toclevels: 2
:sectlinks:

ifndef::snippets[]
:snippets: ./build/generated-snippets
endif::[]

[[common]]
== 공통 스펙

==== 공통 응답 스펙
include::{snippets}/common-response-rest-docs-test/common-response/common-response-fields.adoc[]

Auth-Service 응답메시지는 모두 위와 같은 스펙으로 구성되어 있습니다.

===== code field : 응답 코드 반환값

include::{snippets}/common-response-rest-docs-test/common-response/common-response-fields-code.adoc[]

공통 응답 스펙의 ``code`` 필드에는 위와 같은 값들이 반환될 수 있습니다. +
응답 코드는 ``SUCCESS``인 경우를 제외하고 모두 예외가 발생한 상황입니다.

==== 공통 응답 스펙 - 예외인 경우

include::{snippets}/common-response-rest-docs-test/error-response/common-response-fields-error.adoc[]

예외가 발생한 경우에는 `data` 필드에 위와 같은 형식으로 발생한 예외에 대한 응답이 들어갑니다. +
아래의 예시를 참고해주세요.

include::{snippets}/common-response-rest-docs-test/error-response/response-body.adoc[]

// TODO 문서 수정 필요
===== errorCode field : 예외 응답 코드 반환값

include::{snippets}/common-response-rest-docs-test/error-code/common-response-fields-error-codes.adoc[]

예외 응답 스펙의 ``code`` 필드에는 위와 같은 값들이 반환될 수 있습니다.


[[Login]]
== 0. 로그인

로그인의 경우, 다음 경로로 요청합니다. +
지원하는 providerName을 경로 파라미터로 지정하고, 로그인 성공시,
리다이렉트 할 URL을 지정하여 요청하면, providerName에 맞는 소셜 로그인 화면을
응답으로 내리고, 사용자가 로그인을 진행할 수 있도록 합니다.

GET /oauth2/authorize/{providerName}?redirect_uri={redirect_url}

include::{snippets}/auth-service-rest-docs-test/login/path-parameters.adoc[]

include::{snippets}/auth-service-rest-docs-test/login/request-parameters.adoc[]

로그인을 성공적으로 진행하면, 지정한 ``redirect_url``로 이동하고,
redirect_url의 쿼리 파라미터로 ``token``과 ``expiry``를 담아줍니다.

``token``은 발급받은 AccessToken 값이며, 이는 ``expiry``까지 유효합니다. +
``expiry``는 UNIX TIME 형태를 가지는 숫자값 입니다. +
AccessToken은 인증이 필요한 요청마다 필수로 전송되어야 합니다.

또한 로그인에 성공하면, HttpOnly 쿠키로 RefreshToken을 담아서 반환합니다. +
RefreshToken은 AccessToken이 만료되면, AccessToken을 재발급 받기위한 토큰으로,
30일간 유효합니다.


[[Reissue-Tokens]]
== 1. 토큰 재발급

POST /auth/reissue

[[Reissue-Tokens-Normal]]
=== 1) 정상 흐름

토큰 재발급 기능은 아래 두 조건을 만족하면 정상적으로 처리하고 토큰을 재발급합니다.

----
* 인증 헤더에 만료된 AccessToken을 담아 전송한다.
* 쿠키를 통해 유효한 RefreshToken을 담아 전송한다.
----

==== 요청 예시

include::{snippets}/auth-service-rest-docs-test/reissue-tokens-success/http-request.adoc[]

==== 요청 헤더

include::{snippets}/auth-service-rest-docs-test/reissue-tokens-success/request-headers.adoc[]

include::{snippets}/auth-service-rest-docs-test/reissue-tokens-success/cookie-request-headers.adoc[]

``AccessToken``이 만료되었고 ``RefreshToken``이 유효하다면 토큰을 재발급합니다. +
다음과 같이 응답을 반환합니다.

==== 응답 예시
include::{snippets}/auth-service-rest-docs-test/reissue-tokens-success/http-response.adoc[]

==== 응답 필드
include::{snippets}/auth-service-rest-docs-test/reissue-tokens-success/response-fields-data.adoc[]

==== 응답 헤더
include::{snippets}/auth-service-rest-docs-test/reissue-tokens-success/cookie-response-headers.adoc[]


[[Reissue-Tokens-Error]]
=== 2) 예외

==== 응답 예시 1

``Authorization Header``가 없는 경우, 요청이 실패하고 다음과 같은 응답을 반환합니다.

include::{snippets}/auth-service-rest-docs-test/reissue-tokens-fail-no-access-token/http-response.adoc[]

==== 응답 필드
include::{snippets}/auth-service-rest-docs-test/reissue-tokens-fail-no-access-token/response-fields-data.adoc[]


==== 응답 예시 2

요청 쿠키로 전송된 ``RefreshToken``이 만료된 경우, 요청이 실패하고 다음과 같은 응답을 반환합니다.

include::{snippets}/auth-service-rest-docs-test/reissue-tokens-fail-expired-refresh-token/http-response.adoc[]

==== 응답 필드
include::{snippets}/auth-service-rest-docs-test/reissue-tokens-fail-expired-refresh-token/response-fields-data.adoc[]


[[Logout]]
== 2. 로그아웃

POST /auth/logout

[[Logout-Normal]]
=== 1) 정상 흐름

로그아웃 기능은 아래 조건을 만족하면 정상적으로 처리하고 +
해당 Access Token과 사용자의 Refresh Token을 사용할 수 없게 합니다.

----
* 인증 헤더에 유효한 AccessToken을 담아 전송한다.
----

==== 요청 예시

include::{snippets}/auth-service-rest-docs-test/logout-success/http-request.adoc[]

==== 요청 헤더

include::{snippets}/auth-service-rest-docs-test/logout-success/request-headers.adoc[]

``AccessToken``이 유효하다면 로그아웃을 진행합니다. +
다음과 같이 응답을 반환합니다.

==== 응답 예시
include::{snippets}/auth-service-rest-docs-test/logout-success/http-response.adoc[]

==== 응답 필드
include::{snippets}/auth-service-rest-docs-test/logout-success/response-fields-data.adoc[]


[[Logout-Error]]
=== 2) 예외

==== 응답 예시 1

요청 헤더로 전송된 ``AccessToken``이 유효하지 않을 경우, 요청이 실패하고 다음과 같은 응답을 반환합니다.

include::{snippets}/auth-service-rest-docs-test/logout-fail-invalid-access-token/http-response.adoc[]

==== 응답 필드
include::{snippets}/auth-service-rest-docs-test/reissue-tokens-fail-expired-refresh-token/response-fields-data.adoc[]


[[Validate]]
== 3. 토큰 검증

POST /auth/validate

[[Validate-Normal]]
=== 1) 정상 흐름

AccessToken이 유효한 토큰인지 확인하기 위해 해당 API를 사용할 수 있습니다.

----
* 인증 헤더에 유효한 AccessToken을 담아 전송합니다.
----

==== 요청 예시

include::{snippets}/validate-me/success/http-request.adoc[]

==== 요청 헤더

include::{snippets}/validate-me/success/request-headers.adoc[]

``AccessToken``이 유효하다면 다음과 같은 응답 메시지를 반환합니다.

==== 응답 예시
include::{snippets}/validate-me/success/http-response.adoc[]

==== 응답 필드
include::{snippets}/validate-me/success/response-fields-data.adoc[]


[[Validate-Error]]
=== 2) 예외

==== 응답 예시 1

요청 헤더로 전송된 ``AccessToken``이 유효하지 않을 경우, 요청이 실패하고 다음과 같은 응답을 반환합니다.

include::{snippets}/validate-me/fail/http-response.adoc[]

==== 응답 필드
include::{snippets}/validate-me/fail/response-fields-data.adoc[]

